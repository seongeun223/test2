<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Profile</title>

    <style>
        /* Modal ìŠ¤íƒ€ì¼ */
        .modal {
            display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
            position: fixed; /* í™”ë©´ì— ê³ ì • */
            z-index: 1; /* ë‹¤ë¥¸ ìš”ì†Œ ìœ„ì— í‘œì‹œ */
            left: 0;
            top: 0;
            width: 100%; /* ì „ì²´ ë„ˆë¹„ */
            height: 100%; /* ì „ì²´ ë†’ì´ */
            overflow: auto; /* í•„ìš”ì‹œ ìŠ¤í¬ë¡¤ */
            background-color: rgba(0, 0, 0, 0.4); /* ë°˜íˆ¬ëª… ë°°ê²½ */
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto; /* ì¤‘ì•™ ì •ë ¬ */
            padding: 20px;
            border: 1px solid #888;
            width: 80%; /* ë„ˆë¹„ ì„¤ì • */
            text-align: center; /* í…ìŠ¤íŠ¸ ì¤‘ì•™ ì •ë ¬ */
        }

        .close {
            color: #aaa;
            float: right; /* ìš°ì¸¡ ì •ë ¬ */
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
<h1>ë‚´ ì •ë³´ ì¡°íšŒ</h1>
<div>
    <p>ID: <span th:text="${user.userId}"></span></p>
    <p>PWD : <span th:text="${user.userPwd}"></span></p>
    <p>ì´ë¦„ : <span th:text="${user.userName}"></span></p>
    <p>ì „í™”ë²ˆí˜¸ : <span th:text="${user.userPhone}"></span></p>
</div>
<a th:href="@{/user/edit}">ì •ë³´ ìˆ˜ì •</a>

<button type="button" onclick="showModal()">íšŒì›íƒˆí‡´</button>

<div id="myModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>ì •ë§ë¡œ íšŒì› íƒˆí‡´ë¥¼ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h2>
        <button onclick="confirmDelete()">YES</button>
        <button onclick="closeModal()">NO</button>
    </div>
</div>

<div id="successModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="goToMainPage()">&times;</span>
        <h2>íšŒì› íƒˆí‡´ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</h2>
        <button onclick="goToMainPage()">ì½©ë‹¥..ğŸ¤</button>
    </div>
</div>

<script>
    function showModal() {
        document.getElementById("myModal").style.display = "block"; // ëª¨ë‹¬ ì—´ê¸°
    }

    function closeModal() {
        document.getElementById("myModal").style.display = "none"; // ëª¨ë‹¬ ë‹«ê¸°
    }

    function confirmDelete() {

        console.log("confirmDelete ë™ì‘í•¨...")
        // AJAX ìš”ì²­ìœ¼ë¡œ í¼ ì œì¶œ

        fetch('/user/delete', {
            method: 'POST',
        })
            .then(response => {
                closeModal(); // ì²« ë²ˆì§¸ ëª¨ë‹¬ ë‹«ê¸°
                document.getElementById("successModal").style.display = "block"; // ì„±ê³µ ëª¨ë‹¬ ì—´ê¸°
            })
            .catch(error => {
                alert('íšŒì› íƒˆí‡´ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); // ì˜¤ë¥˜ ì²˜ë¦¬
            });
    }


    function goToMainPage() {

        fetch('auth/logout', {
            method: 'POST',
        })
            .then(response => {
                if (response.ok) {
                    // ë¡œê·¸ì•„ì›ƒ ë° ì‚­ì œ ì„±ê³µ ì‹œ ë¦¬ë‹¤ì´ë ‰íŠ¸
                    window.location.href = "/"; // ë¡œê·¸ì•„ì›ƒ í›„ ì´ë™í•  URL
                } else {
                    alert('íšŒì› íƒˆí‡´ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); // ì˜¤ë¥˜ ì²˜ë¦¬
                }
            })
            .catch(error => {
                console.error("ì˜¤ë¥˜ ë°œìƒ:", error); // ì˜¤ë¥˜ ë¡œê·¸
                alert('íšŒì› íƒˆí‡´ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); // ì˜¤ë¥˜ ì²˜ë¦¬
            });
        // // ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ” ë¡œì§ (ì˜ˆ: ë©”ì¸ í˜ì´ì§€ URL)
        // window.location.href = "/"; // ì ì ˆí•œ ë©”ì¸ í˜ì´ì§€ URLë¡œ ë³€ê²½
    }

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
    window.onclick = function (event) {
        const modal1 = document.getElementById("myModal");
        const modal2 = document.getElementById("successModal");
        if (event.target == modal1) {
            modal1.style.display = "none";
        } else if (event.target == modal2) {
            modal2.style.display = "none";
        }
    }
</script>
</body>
</html>